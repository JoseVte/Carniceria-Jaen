<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>productos_bb.js - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../../";
</script>

<script src="../../../../js/jquery.js"></script>
<script src="../../../../js/darkfish.js"></script>

<link href="../../../../css/fonts.css" rel="stylesheet">
<link href="../../../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../../../Gemfile.html">Gemfile</a>
  
    <li><a href="../../../../Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../../../../README_md.html">README</a>
  
    <li><a href="../../../../Rakefile.html">Rakefile</a>
  
    <li><a href="../../../../app/web/public/css/bootstrap-theme_css.html">bootstrap-theme.css</a>
  
    <li><a href="../../../../app/web/public/css/bootstrap-theme_css_map.html">bootstrap-theme.css.map</a>
  
    <li><a href="../../../../app/web/public/css/bootstrap-theme_min_css.html">bootstrap-theme.min.css</a>
  
    <li><a href="../../../../app/web/public/css/bootstrap_css.html">bootstrap.css</a>
  
    <li><a href="../../../../app/web/public/css/bootstrap_css_map.html">bootstrap.css.map</a>
  
    <li><a href="../../../../app/web/public/css/bootstrap_min_css.html">bootstrap.min.css</a>
  
    <li><a href="../../../../app/web/public/css/estilo_css.html">estilo.css</a>
  
    <li><a href="../../../../app/web/public/css/font-awesome_css.html">font-awesome.css</a>
  
    <li><a href="../../../../app/web/public/css/font-awesome_min_css.html">font-awesome.min.css</a>
  
    <li><a href="../../../../app/web/public/css/notify_css.html">notify.css</a>
  
    <li><a href="../../../../app/web/public/fonts/fontawesome-webfont_svg.html">fontawesome-webfont.svg</a>
  
    <li><a href="../../../../app/web/public/fonts/glyphicons-halflings-regular_svg.html">glyphicons-halflings-regular.svg</a>
  
    <li><a href="../../../../app/web/public/humans_txt.html">humans</a>
  
    <li><a href="../../../../app/web/public/index_html.html">index.html</a>
  
    <li><a href="../../../../app/web/public/index_bb_html.html">index_bb.html</a>
  
    <li><a href="../../../../app/web/public/js/constantes_js.html">constantes.js</a>
  
    <li><a href="../../../../app/web/public/js/lib/backbone_js.html">backbone.js</a>
  
    <li><a href="../../../../app/web/public/js/lib/bootstrap_min_js.html">bootstrap.min.js</a>
  
    <li><a href="../../../../app/web/public/js/lib/jquery-1_11_1_js.html">jquery-1.11.1.js</a>
  
    <li><a href="../../../../app/web/public/js/lib/jquery-1_11_1_min_js.html">jquery-1.11.1.min.js</a>
  
    <li><a href="../../../../app/web/public/js/lib/jquery-1_11_1_min_map.html">jquery-1.11.1.min.map</a>
  
    <li><a href="../../../../app/web/public/js/lib/jquery_cookie_js.html">jquery.cookie.js</a>
  
    <li><a href="../../../../app/web/public/js/lib/mustache_js.html">mustache.js</a>
  
    <li><a href="../../../../app/web/public/js/lib/notify_js.html">notify.js</a>
  
    <li><a href="../../../../app/web/public/js/lib/underscore-min_js.html">underscore-min.js</a>
  
    <li><a href="../../../../app/web/public/js/lib/underscore-min_map.html">underscore-min.map</a>
  
    <li><a href="../../../../app/web/public/js/lib/zepto_min_js.html">zepto.min.js</a>
  
    <li><a href="../../../../app/web/public/js/productos_js.html">productos.js</a>
  
    <li><a href="../../../../app/web/public/js/productos_bb_js.html">productos_bb.js</a>
  
    <li><a href="../../../../app/web/public/js/usuarios_js.html">usuarios.js</a>
  
    <li><a href="../../../../app/web/public/js/utilidades_js.html">utilidades.js</a>
  
    <li><a href="../../../../app/web/public/js/utilidades_bb_js.html">utilidades_bb.js</a>
  
    <li><a href="../../../../app/web/public/less/bordered-pulled_less.html">bordered-pulled.less</a>
  
    <li><a href="../../../../app/web/public/less/core_less.html">core.less</a>
  
    <li><a href="../../../../app/web/public/less/fixed-width_less.html">fixed-width.less</a>
  
    <li><a href="../../../../app/web/public/less/font-awesome_less.html">font-awesome.less</a>
  
    <li><a href="../../../../app/web/public/less/icons_less.html">icons.less</a>
  
    <li><a href="../../../../app/web/public/less/larger_less.html">larger.less</a>
  
    <li><a href="../../../../app/web/public/less/list_less.html">list.less</a>
  
    <li><a href="../../../../app/web/public/less/mixins_less.html">mixins.less</a>
  
    <li><a href="../../../../app/web/public/less/path_less.html">path.less</a>
  
    <li><a href="../../../../app/web/public/less/rotated-flipped_less.html">rotated-flipped.less</a>
  
    <li><a href="../../../../app/web/public/less/spinning_less.html">spinning.less</a>
  
    <li><a href="../../../../app/web/public/less/stacked_less.html">stacked.less</a>
  
    <li><a href="../../../../app/web/public/less/variables_less.html">variables.less</a>
  
    <li><a href="../../../../app/web/public/robots_txt.html">robots</a>
  
    <li><a href="../../../../app/web/public/scss/_bordered-pulled_scss.html">_bordered-pulled.scss</a>
  
    <li><a href="../../../../app/web/public/scss/_core_scss.html">_core.scss</a>
  
    <li><a href="../../../../app/web/public/scss/_fixed-width_scss.html">_fixed-width.scss</a>
  
    <li><a href="../../../../app/web/public/scss/_icons_scss.html">_icons.scss</a>
  
    <li><a href="../../../../app/web/public/scss/_larger_scss.html">_larger.scss</a>
  
    <li><a href="../../../../app/web/public/scss/_list_scss.html">_list.scss</a>
  
    <li><a href="../../../../app/web/public/scss/_mixins_scss.html">_mixins.scss</a>
  
    <li><a href="../../../../app/web/public/scss/_path_scss.html">_path.scss</a>
  
    <li><a href="../../../../app/web/public/scss/_rotated-flipped_scss.html">_rotated-flipped.scss</a>
  
    <li><a href="../../../../app/web/public/scss/_spinning_scss.html">_spinning.scss</a>
  
    <li><a href="../../../../app/web/public/scss/_stacked_scss.html">_stacked.scss</a>
  
    <li><a href="../../../../app/web/public/scss/_variables_scss.html">_variables.scss</a>
  
    <li><a href="../../../../app/web/public/scss/font-awesome_scss.html">font-awesome.scss</a>
  
    <li><a href="../../../../app/web/public/templates/CRUDTemplate_mustache.html">CRUDTemplate.mustache</a>
  
    <li><a href="../../../../app/web/public/templates/inicioTemplate_mustache.html">inicioTemplate.mustache</a>
  
    <li><a href="../../../../app/web/public/templates/loginTemplate_mustache.html">loginTemplate.mustache</a>
  
    <li><a href="../../../../app/web/public/templates/productoTemplate_mustache.html">productoTemplate.mustache</a>
  
    <li><a href="../../../../app/web/public/templates/registroTemplate_mustache.html">registroTemplate.mustache</a>
  
    <li><a href="../../../../app/web/public/templates/usuarioTemplate_mustache.html">usuarioTemplate.mustache</a>
  
    <li><a href="../../../../carniceria_sublime-project.html">carniceria.sublime-project</a>
  
    <li><a href="../../../../carniceria_sublime-workspace.html">carniceria.sublime-workspace</a>
  
    <li><a href="../../../../comandosDB_sh.html">comandosDB.sh</a>
  
    <li><a href="../../../../comandosDoc_sh.html">comandosDoc.sh</a>
  
    <li><a href="../../../../config_ru.html">config.ru</a>
  
    <li><a href="../../../../proyecto-carniceria_komodoproject.html">proyecto-carniceria.komodoproject</a>
  
    <li><a href="../../../../spec/javascripts/fixtures/detalles_proyecto_html.html">detalles_proyecto.html</a>
  
    <li><a href="../../../../spec/javascripts/helpers/jasmine-jquery_js.html">jasmine-jquery.js</a>
  
    <li><a href="../../../../spec/javascripts/helpers/lib/jquery-2_1_1_min_js.html">jquery-2.1.1.min.js</a>
  
    <li><a href="../../../../spec/javascripts/helpers/lib/mock-ajax_js.html">mock-ajax.js</a>
  
    <li><a href="../../../../spec/javascripts/principalSpec_js.html">principalSpec.js</a>
  
    <li><a href="../../../../spec/javascripts/proyectos_spec_js.html">proyectos_spec.js</a>
  
    <li><a href="../../../../spec/javascripts/saludo_spec_js.html">saludo_spec.js</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page app/web/public/js/productos_bb.js">

<pre>Created by josrom on 2/12/14.</pre>

<p>var <a href="../../../../Producto.html">Producto</a> =
Backbone.Model.extend({</p>

<pre>urlRoot: &#39;../api/producto&#39;,
urlCreate: &#39;../api/producto/new&#39;,
urlUpdate: &#39;../api/producto/update&#39;,
defaults: {
    stock: 0,
    ofertas: false,
    rebaja: 0.0,
    url_imagen: &#39;img/missing_prod.png&#39;
},
validate: function (attrs) {
    var errores = [];
    if (!attrs.nombre || attrs.nombre == &quot;&quot;)
        errores.push({msg: &quot;Falta nombre&quot;});
    if (!attrs.precioKg || attrs.precioKg == &quot;&quot;)
        errores.push({msg: &quot;Faltan precioKg&quot;});
    if (errores.length &gt; 0)
        return errores;
},
sync: function (method, model, options) {
    if (method == &#39;GET&#39; || method == &#39;DELETE&#39;)
        options.url = model.urlRoot;
    else if (method == &#39;PUT&#39;)
        options.url = model.urlUpdate;
    else if (method == &#39;POST&#39;)
        options.url = model.urlCreate;

    return Backbone.sync(method, model, options);
},
saveCreate: function (attributes, options) {
    options = _.defaults((options || {}), {
        url: this.urlCreate,
        headers: {&#39;X-Auth-Token&#39;: localStorage.getItem(&#39;token&#39;)}
    });
    return Backbone.Model.prototype.save.call(this, attributes, options);
},
saveUpdate: function (attributes, options) {
    options = _.defaults((options || {}), {
        url: this.urlUpdate,
        headers: {&#39;X-Auth-Token&#39;: localStorage.getItem(&#39;token&#39;)}
    });
    return Backbone.Model.prototype.save.call(this, attributes, options);
}</pre>

<p>});</p>

<p>var ProductoRouter = Backbone.Router.extend({</p>

<pre>routes: {
    &quot;all/:url&quot;: &quot;all&quot;,
    &quot;producto/:id&quot;: &quot;show&quot;,
    &quot;ofertas&quot;: &quot;ofertas&quot;,
    &quot;search/:cadena&quot;: &quot;search&quot;,
    &quot;crud&quot;: &quot;crud&quot;,
    &quot;new&quot;: &quot;crear&quot;,
    &quot;update&quot;: &quot;update&quot;,
    &quot;delete/:id&quot;: &quot;delete&quot;
},
all: function (url) {
    url || (url = &quot;/api/producto/all&quot;);
    var datosProductos = new Catalogo();
    datosProductos.url = url;
    datosProductos.fetch({
        success: function () {
            var productos = new CatalogoView();
            productos.productos = datosProductos;
            productos.render();
        }
    });
},
show: function (id) {
    var datosProducto = new Producto({id: id});
    datosProducto.fetch({
        success: function (datos) {
            var detalles = new DetallesProducto();
            detalles.datos = datos;
            detalles.render();
        },
        fail: function (xhr) {
            console.log(xhr.responseText)
        }
    });
},
ofertas: function () {
    var datosOfertas = new Ofertas();
    datosOfertas.fetch({
        success: function () {
            var ofertas = new OfertasView();
            ofertas.ofertas = datosOfertas;
            ofertas.render();
        }
    });
},
search: function (cadena) {
    var model = new Catalogo();
    var datosBusqueda = model.filtrar_por_nombre(cadena);
    datosBusqueda.fetch({
        success: function () {
            var productos = new CatalogoView();
            productos.productos = datosBusqueda;
            productos.render();
        }
    })
},
crud: function (url) {
    url || (url = &quot;/api/producto/all&quot;);
    var model = new Catalogo();
    model.url = url;
    model.fetch({
        success: function () {
            var productos = new CRUDView();
            productos.productos = model;
            productos.render();
        }
    })
},
crear: function (datos) {
    var model = new Producto(datos);

    model.on(&#39;invalid&#39;, function (model, errors) {
        _.each(errors, function (error, i) {
            $.notify(error.msg, &#39;error&#39;);
        })
    });

    model.saveCreate()
        .success(function (json) {
            console.log(&#39;Creacion con exito&#39;);
            $.notify(&#39;Creacion con exito&#39;);
        })
        .fail(function (xhr) {
            console.log(xhr.responseText);
            $.notify(xhr.responseText, &#39;error&#39;);
        });
},
update: function (datos) {
    var model = new Producto(datos);

    model.on(&#39;invalid&#39;, function (model, errors) {
        _.each(errors, function (error, i) {
            $.notify(error.msg, &#39;error&#39;);
        })
    });

    model.saveUpdate()
        .success(function (json) {
            console.log(&#39;Actualizacion con exito&#39;);
            $.notify(&#39;Actualizacion con exito&#39;);
        })
        .fail(function (xhr) {
            console.log(xhr.responseText);
            $.notify(xhr.responseText, &#39;error&#39;);
        });
},
delete: function (id) {
    var model = new Producto({id: id});

    model.destroy({headers: {&#39;X-Auth-Token&#39;: localStorage.getItem(&#39;token&#39;)}})
        .success(function (msg) {
            console.log(msg);
            $.notify(msg);
        })
        .fail(function (xhr) {
            console.log(xhr.responseText);
            $.notify(xhr.responseText, &#39;error&#39;);
        });
}</pre>

<p>});</p>

<pre>/</pre>

<p>/***************** Productos en oferta</p>

<p>/**********************************************************/</p>

<p>var Ofertas = Backbone.Collection.extend({</p>

<pre>model: Producto,
url: &quot;../api/producto/ofertas&quot;</pre>

<p>}); var OfertasView = Backbone.View.extend({</p>

<pre>el: &#39;#ofertas&#39;,
url_template: &#39;templates/productoTemplate.mustache&#39;,
id_template: &#39;#plantilla_ofertas&#39;,
partial: partial_img_productos,
events: {
    &#39;click a&#39;: &#39;detail&#39;
},
detail: function (e) {
    e.preventDefault();
    productoRouter.navigate(&#39;producto/&#39; + e.currentTarget.id.slice(4));
    productoRouter.show(e.currentTarget.id.slice(4));
},
render: function () {
    var that = this;
    this.$el.load(this.url_template, function () {
        that.template = $(that.id_template).html().replace(&#39;&amp;gt;&#39;, &#39;&gt;&#39;);
        that.$el.html(Mustache.render(that.template, that.ofertas.toJSON(), that.partial));
    });
    return this;
}</pre>

<p>});</p>

<p>/**********************************************************/
/***************** Todos los productos ********************/
/**********************************************************/</p>

<p>var Catalogo = Backbone.Collection.extend({</p>

<pre>model: Producto,
url: &quot;../api/producto/all&quot;,
filtrar_por_nombre: function (cadena) {
    var filtered = this.filter(function (modelo) {
        return modelo.get(&#39;nombre&#39;).indexOf(cadena) &gt;= 0
    });
    return new Producto(filtered);
}</pre>

<p>}); var CatalogoView = Backbone.View.extend({</p>

<pre>el: &quot;#productos&quot;,
url_template: &#39;templates/productoTemplate.mustache&#39;,
id_template: &#39;#plantilla_paginacion&#39;,
partial: partial_img_productos,
events: {
    &#39;click main&gt;div&gt;a&#39;: &#39;detail&#39;,
    &#39;click #next&gt;a&#39;: &#39;pagina&#39;,
    &#39;click #self&gt;a&#39;: &#39;pagina&#39;,
    &#39;click #prev&gt;a&#39;: &#39;pagina&#39;
},
detail: function (e) {
    e.preventDefault();
    productoRouter.navigate(&#39;producto/&#39; + e.currentTarget.id.slice(4));
    productoRouter.show(e.currentTarget.id.slice(4));
},
pagina: function (e) {
    e.preventDefault();
    var url = e.currentTarget.href.replace(&quot;javascript:&quot;, &#39;&#39;).replace(&quot;get_productos_url&quot;, &#39;&#39;).replace(&quot;(&#39;&quot;, &#39;&#39;).replace(&quot;&#39;)&quot;, &#39;&#39;);
    productoRouter.navigate(&#39;all/&#39; + url.replace(&quot;/api/producto/all&quot;, &#39;&#39;));
    productoRouter.all(url);
},
render: function () {
    var that = this;
    this.$el.load(this.url_template, function () {
        that.template = $(that.id_template).html().replace(&#39;&amp;gt;&#39;, &#39;&gt;&#39;);
        that.$el.html(Mustache.render(that.template, that.productos.toJSON()[0], that.partial));
    });
    return this;
}</pre>

<p>});</p>

<p>/**********************************************************/
/***************** Detalles de un producto ****************/
/**********************************************************/</p>

<p>var DetallesProducto = Backbone.View.extend({</p>

<pre>el: &#39;#body&#39;,
url_template: &#39;templates/productoTemplate.mustache&#39;,
id_template: &#39;#plantilla_detalles&#39;,
partial: partial_img_detalles,
render: function () {
    var that = this;
    this.$el.load(this.url_template, function () {
        that.template = $(that.id_template).html().replace(&#39;&amp;gt;&#39;, &#39;&gt;&#39;);
        that.$el.html(Mustache.render(that.template, that.datos.toJSON(), that.partial));
    });
    return this;
}</pre>

<p>});</p>

<p>/**********************************************************/
/***************** CRUD de productos **********************/
/**********************************************************/</p>

<p>var CRUDView = Backbone.View.extend({</p>

<pre>el: &quot;#body&quot;,
url_template: &#39;templates/CRUDTemplate.mustache&#39;,
id_template: &#39;#menu&#39;,
modal_template: &#39;#modal_generic&#39;,
partial: partial_img_productos,
events: {
    &#39;click #new&gt;button&#39;: &#39;crear&#39;,
    &#39;click .detail&gt;button&#39;: &#39;detail&#39;,
    &#39;click .update&gt;button&#39;: &#39;update&#39;,
    &#39;click .delete&gt;button&#39;: &#39;delete&#39;
},
crear: function (e) {
    var button = e.currentTarget;
    var accion = button.dataset.action;
    var that = this;

    that.$el.load(that.url_template, function () {
        that.template = $(accion).html().replace(&#39;&amp;gt;&#39;, &#39;&gt;&#39;);
        that.$el.html(Mustache.render(that.template));
    });
    return that;
},
detail: function (e) {
    var button = e.currentTarget;
    var accion = button.dataset.action;
    var id = button.dataset.id;
    var that = this;

    $.get(&#39;/api/producto/&#39; + id).success(function (data) {
        that.$el.load(that.url_template, function () {
            that.template = $(accion).html().replace(&#39;&amp;gt;&#39;, &#39;&gt;&#39;);
            that.$el.html(Mustache.render(that.template, data));
        });
        return that;
    });
},
update: function (e) {
    var button = e.currentTarget;
    var accion = button.dataset.action;
    var id = button.dataset.id;
    var that = this;

    $.get(&#39;/api/producto/&#39; + id).success(function (data) {
        that.$el.load(that.url_template, function () {
            that.template = $(accion).html().replace(&#39;&amp;gt;&#39;, &#39;&gt;&#39;);
            that.$el.html(Mustache.render(that.template, data, partial_img_productos));
        });
        return that;
    });
},
delete: function (e) {
    var button = e.currentTarget;
    var accion = button.dataset.action;
    var id = button.dataset.id;
    var that = this;

    $.get(&#39;/api/producto/&#39; + id).success(function (data) {
        that.$el.load(that.url_template, function () {
            that.template = $(accion).html().replace(&#39;&amp;gt;&#39;, &#39;&gt;&#39;);
            that.$el.html(Mustache.render(that.template, data));
        });
        return that;
    });
},
render: function () {
    var that = this;
    this.$el.load(this.url_template, function () {
        that.template = $(that.id_template).html().replace(&#39;&amp;gt;&#39;, &#39;&gt;&#39;);
        that.partial.funcion = &quot;productoRouter.crud&quot;;
        that.$el.html(Mustache.render(that.template, that.productos.toJSON()[0], that.partial));
    });
    return this;
}</pre>

<p>});</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

